<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>instakimkc — Enter ID</title>
  <style>
    :root{--bg:#0f172a;--card:#0b1220;--accent:#06b6d4;--muted:#94a3b8;--glass: rgba(255,255,255,0.03)}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial;background:linear-gradient(180deg,#071026 0%, #071a2a 100%);color:#e6eef6;min-height:100vh;display:grid;place-items:center;padding:24px}
    .card{width:100%;max-width:720px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:28px;box-shadow:0 8px 30px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.03)}
    h1{margin:0 0 8px;font-size:28px;letter-spacing:0.6px}
    p.lead{margin:0 0 18px;color:var(--muted)}
    .row{display:flex;gap:12px}
    input[type="text"]{flex:1;padding:12px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:var(--glass);color:inherit;font-size:15px}
    button{padding:11px 14px;border-radius:10px;border:0;background:linear-gradient(90deg,var(--accent),#7dd3fc);color:#022;cursor:pointer;font-weight:600}
    .output{margin-top:18px;padding:14px;border-radius:10px;background:rgba(255,255,255,0.02);display:flex;gap:10px;align-items:center}
    .pw{font-family:monospace;padding:8px 12px;border-radius:8px;background:rgba(0,0,0,0.25);}
    .meta{color:var(--muted);font-size:13px}
    .timer{margin-top:18px}
    .bar{width:100%;height:18px;background:rgba(255,255,255,0.06);border-radius:999px;overflow:hidden}
    .bar > i{display:block;height:100%;width:100%;background:linear-gradient(90deg,var(--accent),#7dd3fc);transform-origin:left;transition:width 0.3s linear}
    .small{font-size:13px;color:var(--muted)}
    .controls{display:flex;gap:8px;margin-top:12px}
    .ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted);padding:8px 10px;border-radius:8px;cursor:pointer}
    .muted-note{margin-top:12px;color:var(--muted);font-size:13px}
    @media (max-width:520px){.row{flex-direction:column}button{width:100%}}
  </style>
</head>
<body>
  <main class="card" role="main">
    <h1>instakimkc</h1>
    <p class="lead">Enter an ID to generate a password and start an 8-hour timer that shows time left.</p>

    <div class="row" role="form" aria-label="Enter ID form">
      <input id="idInput" type="text" inputmode="text" placeholder="Enter ID (anything)" aria-label="ID input" />
      <button id="enterBtn">Enter</button>
    </div>

    <div id="output" class="output" style="display:none">
      <div>
        <div class="meta">Password</div>
        <div style="display:flex;align-items:center;gap:8px">
          <div id="password" class="pw">—</div>
          <button id="copyBtn" class="ghost">Copy</button>
        </div>
      </div>
      <div style="margin-left:auto;text-align:right">
        <div class="meta">Timer</div>
        <div id="timeText" class="pw">08:00:00</div>
      </div>
    </div>

    <div class="timer">
      <div class="small">Time left</div>
      <div class="bar" aria-hidden="true">
        <i id="progress" style="width:100%"></i>
      </div>
      <div class="controls">
        <button id="pauseBtn" class="ghost">Pause</button>
        <button id="resetBtn" class="ghost">Reset</button>
      </div>
      <div class="muted-note">Timer is 8 hours (28800 seconds). When it expires the password will be hidden.</div>
    </div>
  </main>

  <script>
    // Utility: hex from ArrayBuffer
    function toHex(buffer){
      const bytes = new Uint8Array(buffer);
      return Array.from(bytes).map(b=>b.toString(16).padStart(2,'0')).join('');
    }

    // Deterministic password: SHA-256 of the given id, then take base64/url-friendly and slice.
    async function makePassword(id){
      const enc = new TextEncoder();
      const data = enc.encode(id);
      const hashBuffer = await crypto.subtle.digest('SHA-256', data);
      // convert to base64 url-friendly
      const hex = toHex(hashBuffer);
      // map hex to a compact alphanumeric password of length 12
      // take pairs of hex -> number -> base36 to get variety
      let pw = '';
      for(let i=0;i<12;i++){
        const pair = hex.substr((i*2) % hex.length, 2);
        const num = parseInt(pair,16);
        pw += (num % 36).toString(36);
      }
      // mix case: alternate
      pw = pw.split('').map((c,i)=> i%3===0? c.toUpperCase(): c).join('');
      return pw;
    }

    const enterBtn = document.getElementById('enterBtn');
    const idInput = document.getElementById('idInput');
    const output = document.getElementById('output');
    const passwordEl = document.getElementById('password');
    const copyBtn = document.getElementById('copyBtn');
    const progress = document.getElementById('progress');
    const timeText = document.getElementById('timeText');
    const pauseBtn = document.getElementById('pauseBtn');
    const resetBtn = document.getElementById('resetBtn');

    const TOTAL = 8 * 60 * 60; // 28800 seconds
    let remaining = TOTAL;
    let timerId = null;
    let running = false;

    function formatTime(sec){
      if(sec<0) sec=0;
      const h = Math.floor(sec/3600).toString().padStart(2,'0');
      const m = Math.floor((sec%3600)/60).toString().padStart(2,'0');
      const s = Math.floor(sec%60).toString().padStart(2,'0');
      return `${h}:${m}:${s}`;
    }

    function updateUI(){
      const pct = Math.max(0, Math.min(1, remaining / TOTAL));
      progress.style.width = (pct*100) + '%';
      timeText.textContent = formatTime(remaining);
      if(remaining<=0){
        running = false;
        clearInterval(timerId);
        passwordEl.textContent = '— (expired)';
        output.style.opacity = '0.6';
        pauseBtn.textContent = 'Pause';
      }
    }

    function startTimer(){
      if(timerId) clearInterval(timerId);
      running = true;
      timerId = setInterval(()=>{
        if(running){
          remaining -= 1;
          updateUI();
        }
      },1000);
      pauseBtn.textContent = 'Pause';
    }

    function pauseTimer(){
      running = false;
      pauseBtn.textContent = 'Resume';
    }

    enterBtn.addEventListener('click', async ()=>{
      const id = idInput.value.trim();
      if(!id){
        idInput.focus();
        return;
      }
      const pw = await makePassword(id);
      passwordEl.textContent = pw;
      output.style.display = 'flex';
      output.style.opacity = '1';
      // reset timer
      remaining = TOTAL;
      updateUI();
      startTimer();
    });

    copyBtn.addEventListener('click', ()=>{
      const txt = passwordEl.textContent;
      if(!txt || txt.includes('expired')) return;
      navigator.clipboard?.writeText(txt).then(()=>{
        copyBtn.textContent = 'Copied';
        setTimeout(()=> copyBtn.textContent = 'Copy',1200);
      }).catch(()=>{
        copyBtn.textContent = 'Err';
        setTimeout(()=> copyBtn.textContent = 'Copy',1200);
      });
    });

    pauseBtn.addEventListener('click', ()=>{
      if(!timerId) return;
      if(running) pauseTimer(); else { running=true; pauseBtn.textContent='Pause'; }
    });

    resetBtn.addEventListener('click', ()=>{
      remaining = TOTAL;
      updateUI();
      running = false;
      clearInterval(timerId);
      pauseBtn.textContent = 'Pause';
    });

    // allow Enter key in input
    idInput.addEventListener('keydown', (e)=>{
      if(e.key === 'Enter') enterBtn.click();
    });

    // initialize UI
    timeText.textContent = formatTime(TOTAL);
    updateUI();
  </script>
</body>
</html>
